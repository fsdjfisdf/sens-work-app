<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>비밀번호 변경</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/change_password.css" />
</head>
<body>
<div class="change-box">
  <h2>비밀번호 변경</h2>
  <p class="sub">보안을 위해 새로운 비밀번호를 설정해주세요.</p>

  <input type="password" id="current-password" placeholder="현재 비밀번호" />
  <input type="password" id="new-password" placeholder="새 비밀번호" />
  <input type="password" id="confirm-password" placeholder="새 비밀번호 확인" />

  <div class="rule-box">
    • 8~16자 입력<br>
    • 영문 + 숫자 + 특수문자 포함
  </div>

  <div class="error" id="error-msg">비밀번호가 일치하지 않습니다.</div>

  <button id="btn-change">변경하기</button>
</div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    document.getElementById("btn-change").addEventListener("click", async () => {
      const currentPassword = document.getElementById("current-password").value;
      const newPassword = document.getElementById("new-password").value;
      const confirmPassword = document.getElementById("confirm-password").value;

      if (newPassword !== confirmPassword) {
        alert("새 비밀번호가 서로 일치하지 않습니다.");
        return;
      }

      try {
        const token = localStorage.getItem("x-access-token");
        const res = await axios.post(
          "http://3.37.73.151:3001/change-password",
          { currentPassword, newPassword },
          {
            headers: { "x-access-token": token },
          }
        );

        alert(res.data.message);
        if (res.data.isSuccess) {
          window.location.replace("./user_info.html");
        }
      } catch (err) {
        console.error(err);
        alert(
          err.response?.data?.message || "비밀번호 변경 중 오류가 발생했습니다."
        );
      }
    });
  </script>
</body>
</html>
