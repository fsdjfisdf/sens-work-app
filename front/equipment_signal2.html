<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>S-WORKS · Equipment Dashboard v2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/equipment_signal2.css" />

</head>
<body>
  <div class="eq2-app">
    <!-- 좌측: 검색 / 필터 패널 -->
    <aside class="eq2-sidebar">
      <header class="eq2-sidebar-header">
        <h1 class="eq2-title">Equipment Signal</h1>
        <p class="eq2-subtitle">설비를 검색하고 상세 정보를 확인하세요.</p>
      </header>

      <form id="eq-search-form" class="eq2-search-form">
        <div class="eq2-field">
          <label for="filter-eqname">EQ NAME</label>
          <input
            id="filter-eqname"
            type="text"
            placeholder="예: SUPRA XP, PT-P3F-01"
            autocomplete="off"
          />
        </div>

        <div class="eq2-field">
          <label for="filter-group">GROUP</label>
          <select id="filter-group">
            <option value="">ALL</option>
            <option value="PEE1">PEE1</option>
            <option value="PEE2">PEE2</option>
            <option value="PEI1">PEI1</option>
            <!-- 필요시 그룹 추가 -->
          </select>
        </div>

        <div class="eq2-inline-fields">
          <div class="eq2-field">
            <label for="filter-site">SITE</label>
            <select id="filter-site">
              <option value="">ALL</option>
              <option value="PT">PT</option>
              <option value="HS">HS</option>
              <option value="IC">IC</option>
              <option value="CJ">CJ</option>
              <option value="PSKH">PSKH</option>
            </select>
          </div>
          <div class="eq2-field">
            <label for="filter-line">LINE</label>
            <select id="filter-line" disabled>
              <option value="">ALL</option>
            </select>
          </div>
        </div>

        <div class="eq2-inline-fields">
          <div class="eq2-field">
            <label for="filter-type">TYPE</label>
            <select id="filter-type">
              <option value="">ALL</option>
              <option value="SUPRA N">SUPRA N</option>
              <option value="SUPRA XP">SUPRA XP</option>
              <option value="INTEGER">INTEGER</option>
              <option value="PRECIA">PRECIA</option>
              <option value="ECOLITE">ECOLITE</option>
              <option value="GENEVA">GENEVA</option>
              <option value="HDW">HDW</option>
            </select>
          </div>

          <div class="eq2-field">
            <label for="filter-warranty">WARRANTY</label>
            <select id="filter-warranty">
              <option value="">ALL</option>
              <option value="WI">WI</option>
              <option value="WO">WO</option>
            </select>
          </div>
        </div>

        <div class="eq2-actions">
          <button type="submit" class="eq2-btn eq2-btn-primary">SEARCH</button>
          <button type="button" id="eq-reset-btn" class="eq2-btn eq2-btn-ghost">
            RESET
          </button>
        </div>

        <hr class="eq2-divider" />

        <button type="button" id="add-equipment-btn2" class="eq2-btn eq2-btn-outline">
          + ADD EQUIPMENT
        </button>

        <div class="eq2-help">
          <p>· EQ NAME 일부만 입력해도 검색됩니다.</p>
          <p>· SITE를 선택하면 LINE 옵션이 자동으로 바뀝니다.</p>
        </div>
      </form>
    </aside>

    <!-- 우측: 결과 리스트 + 상세 -->
    <main class="eq2-main">
      <!-- 검색 결과 -->
      <section class="eq2-results">
        <div class="eq2-results-header">
          <div>
            <h2>검색 결과</h2>
            <p class="eq2-results-subtitle">
              조건을 변경하여 원하는 설비를 빠르게 찾을 수 있습니다.
            </p>
          </div>
          <div id="eq-result-count" class="eq2-result-count">
            0 Equipments
          </div>
        </div>

        <div id="eq-result-empty" class="eq2-result-empty">
          <p>좌측에서 조건을 입력하고 <strong>SEARCH</strong>를 눌러주세요.</p>
        </div>

        <div id="eq-result-list" class="eq2-result-list">
          <!-- JS로 설비 리스트 렌더링 -->
        </div>
      </section>

      <!-- 설비 상세 -->
      <section class="eq2-detail" id="eq-detail">
        <div class="eq2-detail-empty">
          <p>설비를 선택하면 상세 정보와 INFO를 여기에서 확인할 수 있습니다.</p>
        </div>
      </section>
// INFO 섹션 바로 뒤에 이어서
      <section class="eq2-detail-info">
        <div class="eq2-detail-info-header">
          <span>INFO (특이사항)</span>
        </div>
        <textarea id="eq2-info-textarea" class="eq2-info-textarea" rows="6">${
          eq.INFO || ''
        }</textarea>
        <div class="eq2-detail-info-actions">
          <button type="button" id="eq2-info-save-btn" class="eq2-btn eq2-btn-primary">
            INFO SAVE
          </button>
        </div>
      </section>

      <!-- 🔥 작업 이력 섹션 추가 -->
      <section class="eq2-detail-history">
        <div class="eq2-detail-info-header">
          <span>작업 이력</span>
          <span class="eq2-history-count">${eq2EquipmentLogs.length}건</span>
        </div>
        <div class="eq2-history-list">
          ${
            eq2EquipmentLogs.length === 0
              ? '<p class="eq2-history-empty">등록된 작업 이력이 없거나, 최근 200건 이내에 작업이 없습니다.</p>'
              : eq2EquipmentLogs
                  .map((log) => {
                    const date = formatDateOnly(log.task_date);
                    const st = formatTimeOnly(log.start_time);
                    const et = formatTimeOnly(log.end_time);
                    const du = formatDuration(log.task_duration);
                    const desc = escapeHtml(log.task_description || '');
                    return `
                      <article class="eq2-history-item">
                        <div class="eq2-history-main">
                          <div class="eq2-history-title-row">
                            <span class="eq2-history-date">${date}</span>
                            <span class="eq2-history-type">${log.work_type || '-'}</span>
                          </div>
                          <div class="eq2-history-title">${escapeHtml(
                            log.task_name || ''
                          )}</div>
                          <div class="eq2-history-meta">
                            <span>작업자: ${escapeHtml(log.task_man || '-')}</span>
                            <span>시간: ${st} ~ ${et} (${du})</span>
                          </div>
                        </div>
                        ${
                          desc
                            ? `<details class="eq2-history-desc">
                                 <summary>상세 보기</summary>
                                 <p>${desc}</p>
                               </details>`
                            : ''
                        }
                      </article>
                    `;
                  })
                  .join('')
          }
        </div>
      </section>
    </div>
  `;


  <!-- ADD / EDIT 모달 -->
  <div id="add-equipment-modal2" class="eq2-modal hidden">
    <div class="eq2-modal-backdrop"></div>
    <div class="eq2-modal-content">
      <header class="eq2-modal-header">
        <h2 id="add-equipment-modal-title">Add Equipment</h2>
      </header>

      <form id="add-equipment-form2" class="eq2-modal-form">
        <div class="eq2-modal-grid">
          <div class="eq2-field">
            <label for="eq2-eqname">EQ NAME <span class="eq2-required">*</span></label>
            <input id="eq2-eqname" name="eqname" type="text" />
          </div>

          <div class="eq2-field">
            <label for="eq2-group">GROUP <span class="eq2-required">*</span></label>
            <input id="eq2-group" name="group" type="text" placeholder="예: PEE1" />
          </div>

          <div class="eq2-field">
            <label for="eq2-site-select">SITE <span class="eq2-required">*</span></label>
            <select id="eq2-site-select" name="site">
              <option value="">Select Site</option>
              <option value="PT">PT</option>
              <option value="HS">HS</option>
              <option value="IC">IC</option>
              <option value="CJ">CJ</option>
              <option value="PSKH">PSKH</option>
            </select>
          </div>

          <div class="eq2-field">
            <label for="eq2-line-select">LINE <span class="eq2-required">*</span></label>
            <select id="eq2-line-select" name="line" disabled>
              <option value="">Select Line</option>
            </select>
          </div>

          <div class="eq2-field">
            <label for="eq2-type">TYPE <span class="eq2-required">*</span></label>
            <select id="eq2-type" name="type">
              <option value="">Select Type</option>
              <option value="SUPRA N">SUPRA N</option>
              <option value="SUPRA XP">SUPRA XP</option>
              <option value="INTEGER">INTEGER</option>
              <option value="PRECIA">PRECIA</option>
              <option value="ECOLITE">ECOLITE</option>
              <option value="GENEVA">GENEVA</option>
              <option value="HDW">HDW</option>
            </select>
          </div>

          <div class="eq2-field">
            <label for="eq2-floor">FLOOR</label>
            <input id="eq2-floor" name="floor" type="text" placeholder="예: 2F" />
          </div>

          <div class="eq2-field">
            <label for="eq2-bay">BAY</label>
            <input id="eq2-bay" name="bay" type="text" placeholder="예: BAY-12" />
          </div>

          <div class="eq2-field">
            <label for="eq2-start-date">START DATE <span class="eq2-required">*</span></label>
            <input id="eq2-start-date" name="start_date" type="date" />
          </div>

          <div class="eq2-field">
            <label for="eq2-end-date">END DATE <span class="eq2-required">*</span></label>
            <input id="eq2-end-date" name="end_date" type="date" />
          </div>

          <div class="eq2-field">
            <label for="eq2-warranty-status">WARRANTY <span class="eq2-required">*</span></label>
            <select id="eq2-warranty-status" name="warranty_status">
              <option value="">Select</option>
              <option value="WI">WI</option>
              <option value="WO">WO</option>
            </select>
          </div>
        </div>

        <div class="eq2-field eq2-field-full">
          <label for="eq2-info">INFO</label>
          <textarea
            id="eq2-info"
            name="info"
            rows="4"
            placeholder="설비 특이사항을 자유롭게 작성하세요."
          ></textarea>
        </div>

        <footer class="eq2-modal-footer">
          <button type="button" id="cancel-add-equipment-btn2" class="eq2-btn eq2-btn-ghost">
            취소
          </button>
          <button type="submit" id="save-equipment-btn2" class="eq2-btn eq2-btn-primary" disabled>
            저장
          </button>
        </footer>
      </form>
    </div>
  </div>
    <!-- axios CDN -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" defer></script>
  <script src="./js/equipment_add2.js" defer></script>
  <script src="./js/equipment_signal2.js" defer></script>
</body>
</html>
