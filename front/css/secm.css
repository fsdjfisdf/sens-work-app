/* =============================================================================
   S-WORKS — SECM (Dark Unified)
   Version: 2025-08-22
   Focus: Consistent dark theme + crystal-clear search panel + tidy graph cards
   ============================================================================= */

/* ---------- Design Tokens --------------------------------------------------- */
:root{
  /* Surfaces */
  --bg:#0b0f14;             /* page */
  --surface:#0d131d;        /* section base */
  --panel:#111720;          /* cards / nav */
  --panel-2:#0f1722;        /* secondary card */

  /* Text */
  --text:#e9eef5;           /* primary text */
  --muted:#b8c2cf;          /* secondary text */
  --dim:#8aa0b4;            /* captions */

  /* Brand */
  --accent:#60a5fa;
  --accent-weak: rgba(96,165,250,.16);

  /* Borders & Shadows */
  --border:#1e2a3a;
  --inset:rgba(255,255,255,.06);
  --shadow-xs: 0 1px 1px rgba(0,0,0,.25);
  --shadow-sm: 0 2px 6px rgba(0,0,0,.28);
  --shadow:    0 10px 26px rgba(0,0,0,.38);
  --shadow-lg: 0 18px 48px rgba(0,0,0,.50);

  /* Rings */
  --ring-outer:0 0 0 6px rgba(96,165,250,.14);
  --ring-inner:0 0 0 1px rgba(96,165,250,.65);

  /* Radius / Spacing */
  --radius:16px; --radius-md:12px; --radius-sm:10px; --radius-xs:8px;
  --gap:16px; --gap-lg:20px;

  /* Canvas heights (for charts) */
  --chart-h:420px;
  --chart-h-wide:460px;
  --chart-h-lap:360px;
  --chart-h-tab:320px;
}

/* ---------- Base ------------------------------------------------------------ */
*,
*::before,
*::after{ box-sizing:border-box; }

html,body{ height:100%; }

body{
  margin:0; background: var(--bg); color:var(--text);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', Arial, sans-serif;
  -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
}

img,svg,canvas{ display:block; max-width:100%; }

a{ color:var(--accent); text-decoration:none; text-underline-offset:2px; }
a:hover{ text-decoration:underline; }

.hidden{ display:none !important; }
.sr-only{
  position:absolute; width:1px; height:1px; margin:-1px; padding:0; overflow:hidden;
  clip:rect(0,0,0,0); white-space:nowrap; border:0;
}

/* Focus ring */
:where(a,button,input,select,textarea):focus-visible{
  outline:0; box-shadow: var(--ring-inner), var(--ring-outer);
  border-color: rgba(96,165,250,.65) !important;
}

/* ---------- Containers ------------------------------------------------------ */
.inner{ max-width: 2048px; margin: 0 auto; padding: 0 16px; }

/* ---------- Loading Overlay ------------------------------------------------- */
.loading-overlay{
  position:fixed; inset:0; z-index:9999; display:flex; align-items:center; justify-content:center;
  background: rgba(2,6,23,.76); transition: opacity .25s ease;
}
.loading-overlay .loading-text{ margin-top:14px; color:var(--muted); }
.spinner{
  width:54px; height:54px; border-radius:50%;
  border:3px solid rgba(255,255,255,.18);
  border-top-color: var(--accent);
  animation:spin 1s linear infinite; margin:0 auto 10px;
}
@keyframes spin{ to{ transform:rotate(360deg) } }

/* ---------- Nav ------------------------------------------------------------- */
nav{
  position:sticky; top:0; z-index:8000;
  background: var(--panel);
  border-bottom:1px solid var(--border); box-shadow: var(--shadow);
}
nav .inner{ padding: 8px 16px; }
.nav-container{ display:flex; align-items:center; justify-content:space-between; gap:10px; min-height:56px; }
.nav-title a{
  display:inline-block; font-weight:900; letter-spacing:.2px; font-size:19px;
  color:#eaf2ff; padding:6px 8px; border-radius:10px;
}
.nav-title a:hover{ color:var(--accent); }

.sign-container{ display:flex; align-items:center; gap:8px; }
.sign-link, .menu-item, .menu-btn{
  display:inline-flex; align-items:center; gap:8px; height:34px; padding:0 12px;
  border-radius:10px; border:1px solid var(--border); background:#0f172a; color:#d7e7ff;
  font-size:13px; cursor:pointer; transition: all .18s ease; box-shadow: var(--shadow-xs);
}
.sign-link:hover, .menu-item:hover, .menu-btn:hover{
  background:#152338; border-color:#2a4770; color:#e9f2ff;
}
.menu-btn:active{ transform: translateY(1px); }

.menu-icon{ width:22px; height:14px; position:relative; color:#b8c2cf; }
.menu-icon span{
  position:absolute; left:0; right:0; height:2px; border-radius:2px; background:currentColor;
  transform-origin:center; transition:transform .2s, opacity .2s, top .2s;
}
.menu-icon span:nth-child(1){ top:0 } .menu-icon span:nth-child(2){ top:6px } .menu-icon span:nth-child(3){ top:12px }

.menu-bar{
  background: var(--panel);
  border-top:1px solid var(--border);
  overflow:hidden; max-height:0; transition:max-height .28s ease; will-change:max-height;
  box-shadow: inset 0 8px 18px rgba(0,0,0,.22);
}
.menu-bar.open{ max-height:640px; }
.menu-bar-content{
  max-width:2048px; margin:0 auto; padding: 8px 12px; display:flex; flex-wrap:wrap; gap:8px;
}
.menu-item.admin-only::after{ content:"• admin"; font-size:11px; opacity:.55; margin-left:6px }

/* ---------- Main / Sections ------------------------------------------------- */
main{ padding: 26px 0 40px; }
.section-title{
  margin: 10px 2px 14px; font-size:22px; font-weight:900; letter-spacing:-.015em; color:#eaf2ff;
}

/* =============================================================================
   SEARCH PANEL — 명확한 그룹화 · 상단 제목/부제 · 라벨 표시 · sticky
   ============================================================================= */
.search-container{
  position: relative;       /* sticky → relative */
  top: auto;                /* 혹시 남아있을 값 무력화 */
  z-index: auto;            /* 그래프 위로 겹치지 않도록 */
  background: linear-gradient(180deg, rgba(15,23,42,.65), rgba(15,23,42,.35));
  border:1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px;
  margin: 0 0 16px;         /* 아래와 적당한 간격 */
  backdrop-filter: blur(6px) saturate(115%);
}

.filters-row{
  background: var(--panel-2);
  border:1px solid var(--border);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-xs);
  padding: 12px 12px 14px;
}
.filters-row + .filters-row{ margin-top: 12px; }

/* Block head (섹션 제목/부제) */
.block-head{
  display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
  margin: 4px 2px 10px;
  border-bottom: 1px dashed rgba(148,163,184,.18);
  padding-bottom: 8px;
}
.block-title{
  margin:0; font-size:14px; font-weight:900; letter-spacing:.2px; color:#eaf2ff;
}
.block-sub{
  margin:0; font-size:12px; color:var(--dim);
}

/* Field grid */
.fields{
  display:grid; gap:12px 14px;
  grid-template-columns: repeat(12, minmax(0, 1fr));
}

/* Common field */
.field{
  grid-column: span 4;                    /* 기본 3열 */
  display:flex; flex-direction:column; gap:6px;
  min-width: 180px;
}
.field.grow{ grid-column: span 6; }       /* 이름 입력 넓게 */
@media (max-width: 1200px){
  .field{ grid-column: span 6; }          /* 2열 */
  .field.grow{ grid-column: span 12; }
}
@media (max-width: 780px){
  .field, .field.grow{ grid-column: span 12; } /* 1열 */
}

/* Labels */
.field label{
  color:#cbd8ea; font-size:12px; letter-spacing:.25px;
  display:inline-flex; align-items:center; gap:6px;
}

/* Inputs / selects */
.field select,
.field input[type="text"],
.field input[list]{
  height: 40px; border-radius: 10px;
  border:1px solid var(--border);
  background: #0c1727; color:#eaf2ff;
  padding: 0 12px; box-shadow: inset 0 1px 0 rgba(0,0,0,.35);
  transition: border-color .18s ease, background .18s ease, box-shadow .18s ease;
}
.field select:hover,
.field input:hover{ border-color:#35507a; }
.field select:focus,
.field input:focus{ border-color:#4c79b9; background:#0b1c34; }

/* Custom select arrow */
.field select{
  appearance:none;
  background-image:
    linear-gradient(45deg, #96c2ff 50%, transparent 50%),
    linear-gradient(135deg, #96c2ff 50%, transparent 50%);
  background-position:
    calc(100% - 18px) 17px,
    calc(100% - 12px) 17px;
  background-size: 6px 6px, 6px 6px;
  background-repeat: no-repeat;
  padding-right: 34px;
}

/* Actions cluster */
.name-actions .fields{
  align-items:end;
}
.actions{
  grid-column: span 6;
  display:flex; flex-wrap:wrap; gap:8px; justify-content:flex-end;
}
@media (max-width: 1200px){ .actions{ grid-column: span 12; justify-content:flex-start; } }

.btn{
  height: 40px; padding: 0 14px; border-radius: 10px;
  font-weight:800; letter-spacing:.2px; cursor:pointer;
  border:1px solid var(--border); color:#dfe9ff; background:#0f172a;
  transition: transform .08s ease, filter .18s ease, border-color .18s ease, box-shadow .18s ease, background .18s ease;
}
.btn:hover{ border-color:#35507a; background:#152742; }
.btn:active{ transform: translateY(1px); }

.btn.primary{
  background: linear-gradient(180deg, #1f4b9a 0%, #173a78 100%);
  border-color:#2b4d86; box-shadow: 0 10px 24px rgba(34,112,255,.18), inset 0 1px 0 rgba(255,255,255,.08);
}
.btn.primary:hover{ filter: brightness(1.05); }
.btn.ghost{
  background: #0d1727; color:#cfe0f5;
}
.btn.outline{
  background: transparent; border-color:#33527f; color:#d1e2ff;
}

/* =============================================================================
   TAB BUTTONS (INFO / LEVEL / …)
   ============================================================================= */
.button-container{
  display:flex; flex-wrap:wrap; gap:8px; margin: 12px 0 18px;
  background: #0f1722; border:1px solid var(--border); border-radius: var(--radius);
  padding: 8px; box-shadow: var(--shadow-xs);
}
.button-container button{
  appearance:none; border:1px solid #1e2a3a; border-radius:999px;
  background:#0b1a2f; color:#cfe0f5; height:36px; padding:0 14px;
  font-weight:800; letter-spacing:.2px; cursor:pointer; transition: all .18s ease;
}
.button-container button:hover{
  background:#142b4b; color:#e9eef5; border-color:#35507a; box-shadow: var(--shadow-xs);
}
.button-container button.active{
  background: linear-gradient(180deg, #18325a 0%, #0f264a 100%);
  color:#d8e7ff; border-color:#2b4d86; box-shadow: var(--shadow-sm);
}

/* =============================================================================
   PERSON INFO PANEL
   ============================================================================= */
.person-info{
  background: var(--panel-2);
  border:1px solid var(--border); border-radius: var(--radius-md);
  box-shadow: var(--shadow-xs);
  padding: 12px 14px; margin: 0 0 16px;
}
.person-info p{
  margin:6px 0; color:#dbe7fb; font-size:14px;
}
.person-info strong{ color:#9fb6d6; font-weight:800; }

/* =============================================================================
   GRAPH AREA — tidy rows / card polish
   ============================================================================= */
.graph-container{ display:block; }

.graph-group{ margin: 16px 0 10px; }
.group-title{
  margin: 0 2px 10px; font-size: 16px; font-weight:900; color:#dbe7fb;
}

/* Rows use 12-col grid */
.graph-row{
  display:grid; gap: 14px; grid-template-columns: repeat(12, minmax(0, 1fr));
  margin-bottom: 8px;
}

/* Item widths (12-col) */
.graph-item{ grid-column: span 12; }
.graph-item.small{ grid-column: span 4; }   /* → 한 줄에 3개 */
.graph-item.medium{ grid-column: span 6; }  /* → 한 줄에 2개 */
.graph-item.wide{ grid-column: span 12; }   /* → 전체폭 */

@media (max-width: 1200px){
  .graph-item.small{ grid-column: span 6; }
}
@media (max-width: 780px){
  .graph-item.small, .graph-item.medium, .graph-item.wide{ grid-column: span 12; }
}

/* Graph card */
.graph-item{
  background: var(--panel-2);
  border:1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px 12px 14px;
  display:flex; flex-direction:column; gap:10px; position:relative;
  transition: transform .08s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
}
.graph-item:hover{ transform: translateY(-1px); box-shadow: var(--shadow-lg); border-color:#2b4d86; }

.graph-header{
  display:flex; align-items:center; gap:10px; margin:2px 2px 4px;
  padding-bottom: 8px; border-bottom:1px dashed rgba(148,163,184,.18);
}
.graph-header h3{
  margin:0; font-size:14px; font-weight:900; color:#eef6ff; letter-spacing:.2px;
}

.info-button{
  margin-left:auto; width:22px; height:22px; border-radius:999px;
  display:inline-flex; align-items:center; justify-content:center;
  border:1px solid var(--border); background:#0f172a; color:#9fb2c7;
  font-weight:900; cursor:pointer; transition: all .18s ease; box-shadow: var(--shadow-xs);
}
.info-button:hover{ border-color:#35507a; background:#162742; color:#e9eef5; }
.info-button:active{ transform: translateY(1px); }

.canvas-container{ width:100%; }
.canvas-container canvas{
  inline-size:100%;
  block-size: var(--chart-h);
  background: linear-gradient(180deg, rgba(2,6,23,.10), rgba(2,6,23,0) 28%);
  border-radius: 12px; box-shadow: inset 0 1px 0 rgba(255,255,255,.04);
}
@media (min-width: 1600px){ .canvas-container canvas{ block-size: var(--chart-h-wide); } }
@media (max-width: 1280px){ .canvas-container canvas{ block-size: var(--chart-h-lap); } }
@media (max-width: 900px){  .canvas-container canvas{ block-size: var(--chart-h-tab); } }

/* =============================================================================
   Modals
   ============================================================================= */
.modal{
  display:none; position:fixed; inset:0; z-index:9000; padding:24px;
  background: rgba(3,8,20,.55);
  backdrop-filter: blur(8px) saturate(115%);
}
.modal-content{
  margin:auto; width:min(680px, 92vw);
  background:#0f1722; border:1px solid var(--border); border-radius: var(--radius);
  box-shadow: var(--shadow-lg); padding: 18px 16px; position:relative;
  animation: modal-in .16s ease-out;
}
@keyframes modal-in{ from{ transform:translateY(6px); opacity:0 } to{ transform:none; opacity:1 } }
.modal .close{
  position:absolute; top:10px; right:12px;
  font-size:22px; line-height:1; color:#9fb2c7; cursor:pointer; user-select:none;
  transition: color .15s ease, transform .06s ease;
}
.modal .close:hover{ color:#eaf2ff; transform: scale(1.06); }
.modal p{ color:#e9eef5; line-height:1.7; }

/* =============================================================================
   Footer
   ============================================================================= */
footer{ color:#9fb2c7; padding: 20px 0 34px; }
footer p{ margin:6px 2px 0; font-size:12.5px; }

/* =============================================================================
   Leaflet (optional protection)
   ============================================================================= */
.leaflet-container{ background:#0b0f14 !important; }

/* =============================================================================
   High Contrast & Reduced Motion
   ============================================================================= */
@media (prefers-contrast: more){
  :where(a,button,input,select,textarea):focus-visible{
    box-shadow: 0 0 0 4px rgba(255,255,255,.6), 0 0 0 2px var(--accent);
  }
  .graph-item, .filters-row{ border-color: #2b496f; }
  .block-head{ border-bottom-color: #2b496f; }
}
@media (prefers-reduced-motion: reduce){
  *{
    animation-duration:.001ms !important;
    animation-iteration-count:1 !important;
    transition-duration:.001ms !important;
    scroll-behavior:auto !important;
  }
}

/* =============================================================================
   Print
   ============================================================================= */
@media print{
  nav, .menu-bar, .search-container, .button-container, .info-button, .modal{ display:none !important; }
  body{ background:#fff; color:#000; }
  .graph-item{ break-inside: avoid; box-shadow:none; border-color:#d1d5db; background:#fff; }
  .canvas-container canvas{ border:1px solid #e5e7eb; background:#fff; }
}
