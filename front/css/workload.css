:root{
  --bg:#0b0f14; --panel:#111720; --muted:#8aa0b4; --text:#e9eef5; --accent:#60a5fa;
  --border:#1e2a3a; --chip:#0f2236;
  --u100:#4a0b0b; --u70:#40260a; --u0:#0c2c2a;

  /* Nav (theme-aware) */
  --nav-bg: var(--panel, #0f172a);
  --nav-fg: var(--text, #e2e8f0);
  --nav-fg-dim: var(--muted, #cbd5e1);
  --nav-accent: var(--accent, #60a5fa);
  --nav-border: var(--border, rgba(148,163,184,0.25));
  --menu-bg: var(--panel, #111827);
  --menu-item-bg: transparent;
  --menu-item-hover: rgba(255,255,255,0.06);
  --shadow: 0 4px 14px rgba(2,6,23,0.18);
}

@media (prefers-color-scheme: light){
  :root{
    --nav-bg:#fff; --nav-fg:#0f172a; --nav-fg-dim:#334155; --nav-accent:#2563eb;
    --nav-border:rgba(15,23,42,0.08); --menu-bg:#fff; --menu-item-hover:rgba(2,6,23,0.05);
    --shadow:0 4px 14px rgba(2,6,23,0.08);
  }
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;color:var(--text);background:#0b0f14;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',Arial,sans-serif;
}

/* ===== Page shell ===== */
.container{max-width:2000px;margin:32px auto;padding:0 16px}
.header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.title{font-size:26px;font-weight:800;letter-spacing:-.02em}
.pill{font-size:12px;color:var(--accent);background:rgba(96,165,250,.12);padding:6px 10px;border:1px solid rgba(96,165,250,.35);border-radius:999px}

/* ===== Panel ===== */
.panel{
  background:linear-gradient(180deg,#121a26 0%,#0e1520 100%);
  border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden;
}
.panel-header{
  display:grid;gap:12px;padding:16px 18px;border-bottom:1px solid var(--border);
  grid-template-columns: 1fr auto; /* 좌: 필터, 우: 액션 */
  align-items:end;
}
.panel-body{padding:16px 18px}

/* ===== Filters (12그리드) ===== */
.filters{
  display:grid;
  grid-template-columns: repeat(12, 1fr);
  gap:12px 16px;
  align-items:end;
}

/* 기본: 1칸=1fr, 각 필드는 3칸(=4개/행) */
.field{
  display:flex; flex-direction:column; gap:6px;
  grid-column: span 3;
  min-width:160px;
}
.field label{font-size:12px;color:var(--muted);margin-bottom:2px}
.field input,.field select{
  height:38px;border-radius:10px;border:1px solid var(--border);
  background:#0c121a;color:var(--text);padding:0 12px
}

/* 유틸 스팬 */
.span-6{ grid-column: span 6; }   /* 2칸/행(그룹/사이트, 기준/기준시간) */
.span-12{ grid-column: 1 / -1; }  /* 한 줄 전체(토글) */

/* 날짜 입력 */
.field-date .date-input{ position:relative; display:flex; align-items:center }
.field-date .date-input input[type=date]{ width:100%; padding-right:38px }
.cal-btn-input{
  position:absolute; right:6px; top:50%; transform:translateY(-50%);
  height:28px;width:32px;border-radius:8px;border:1px solid var(--border);
  background:#0c121a;color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;
}

/* 체크박스 필드(최근 30일/최근 3개월)를 인풋처럼 */
.check-field .input-chip{
  display:flex; align-items:center; justify-content:center;
  height:38px; width:100%;
  border-radius:10px; border:1px solid var(--border);
  background:var(--chip); font-size:12px;
}

/* 숫자 입력 폭 */
.field-number input[type="number"]{ max-width:160px }

/* 토글 행 */
.toggle-row{ }
.toggles{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
.chip{
  display:inline-flex; align-items:center; gap:8px;
  background:var(--chip); border:1px solid var(--border);
  padding:8px 10px; border-radius:999px; font-size:12px;
}
.chip.sm{ padding:6px 8px; font-size:12px }
.chip input{ accent-color:var(--accent); height:18px }

/* 반응형 */
@media (max-width: 1200px){
  .field{ grid-column: span 4; }  /* 3개/행 */
  .span-6{ grid-column: span 6; }
}
@media (max-width: 900px){
  .field{ grid-column: span 6; }  /* 2개/행 */
}
@media (max-width: 560px){
  .field, .span-6, .span-12{ grid-column: span 12; } /* 1개/행 */
}

/* ===== Actions ===== */
.actions{ display:flex; gap:10px; align-self:end; justify-self:end }
.btn{
  height:38px;padding:0 14px;border-radius:10px;border:1px solid var(--border);
  background:#0c121a;color:#e9eef5;cursor:pointer
}
.btn.primary{background:linear-gradient(180deg,#2a70ff 0%,#1a55d6 100%);border-color:#2a70ff}
.btn.ghost{background:transparent}

/* ===== Tabs & KPI ===== */
.tabs{display:flex;gap:6px;margin:14px 0;flex-wrap:wrap}
.tab{border:1px solid var(--border);background:#0c121a;color:var(--text);padding:8px 12px;border-radius:999px;cursor:pointer;font-size:13px}
.tab.active{border-color:var(--accent);box-shadow:0 0 0 1px rgba(96,165,250,.5) inset}

.kpis{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
.kpi{background:#0f1722;border:1px solid var(--border);border-radius:14px;padding:16px}
.kpi .label{color:var(--muted);font-size:12px}
.kpi .value{font-size:28px;font-weight:800;margin-top:4px;letter-spacing:-.02em}
.kpi .sublabel{color:var(--muted);font-size:12px;margin-top:6px}

.view{display:none}
.view.active{display:block}

.section-title{margin:16px 2px 8px;font-size:16px;color:#cfe0f5}
.chart-card{background:#0f1722;border:1px solid var(--border);border-radius:14px;padding:12px;margin-bottom:12px}

/* 랭킹 스크롤 */
.scroll-x{overflow-x:auto}
.scroll-x canvas{display:block}

/* 랭킹 검색 */
.rank-controls{display:flex;gap:8px;align-items:center;margin:6px 2px 10px}
.rank-controls input{
  height:36px;border-radius:10px;border:1px solid var(--border);
  background:#0c121a;color:var(--text);padding:0 12px;min-width:260px
}

/* ===== Calendar ===== */
.calendar-header{display:flex;align-items:center;justify-content:center;gap:10px;margin:10px 0 6px}
.cal-title{font-weight:700;letter-spacing:.5px}
.cal-btn{background:#0c121a;border:1px solid var(--border);color:#e9eef5;border-radius:8px;padding:6px 10px;cursor:pointer}

.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.cal-cell{background:#0f1722;border:1px solid var(--border);border-radius:10px;padding:8px;min-height:84px;position:relative;cursor:pointer;transition:background-color .2s ease}
.cal-cell .day{font-size:12px;color:#9fb2c7}
.cal-cell .util{position:absolute;bottom:8px;right:10px;font-weight:800}
.cal-cell.holiday{background:#0e1420;border-color:#132036}
.cal-head{font-weight:700;text-align:center;color:#9fb2c7;padding:6px 0}

.cal-cell.util100{background:var(--u100)}
.cal-cell.util70{background:var(--u70)}
.cal-cell.util0{background:var(--u0)}

.legend{margin-top:8px;color:#9fb2c7;font-size:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.lg{display:inline-flex;align-items:center;gap:6px}
.lg-holiday::before,.lg-u100::before,.lg-u70::before,.lg-u0::before{content:'';width:12px;height:12px;border-radius:4px;display:inline-block}
.lg-holiday::before{background:#0e1420;border:1px solid #132036}
.lg-u100::before{background:var(--u100)}
.lg-u70::before{background:var(--u70)}
.lg-u0::before{background:var(--u0)}

/* ===== Modal ===== */
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5)}
.modal.hidden{display:none}
.modal-content{width:min(720px,92vw);background:#0f1722;border:1px solid var(--border);border-radius:16px;overflow:hidden}
.modal-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border)}
.modal-title{font-weight:800}
.modal-close{background:transparent;color:#889db3;border:none;font-size:18px;cursor:pointer}
.modal-body{padding:14px 16px}
.modal-kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:10px}
.modal-kpis div{background:#0c121a;border:1px solid var(--border);border-radius:10px;padding:10px}
.modal-kpis span{color:#9fb2c7;font-size:12px;display:block;margin-bottom:4px}
.modal-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:6px}
.modal-grid div{background:#0c121a;border:1px solid var(--border);border-radius:10px;padding:10px}
.modal-grid span{color:#9fb2c7;font-size:12px;display:block;margin-bottom:4px}

/* ===== Nav ===== */
.hidden { display: none !important; }

nav{
  position:sticky; top:0; z-index:8000;
  background:var(--nav-bg); color:var(--nav-fg);
  border-bottom:1px solid var(--nav-border); box-shadow:var(--shadow);
}
nav .inner{max-width:2000px;margin:0 auto;padding:6px 12px}
.nav-container{display:flex;align-items:center;justify-content:space-between;gap:10px}

.nav-title a{
  display:inline-block;font-weight:800;letter-spacing:.2px;font-size:18px;
  color:var(--nav-fg);text-decoration:none;padding:4px 6px;border-radius:8px
}
.nav-title a:hover{color:var(--nav-accent)}

.sign-container{display:flex;align-items:center;gap:8px}
.sign-link{
  display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:8px;
  color:var(--nav-fg);text-decoration:none;background:var(--menu-item-bg);
  border:1px solid var(--nav-border);font-size:13px;
  transition:background .2s,color .2s,border-color .2s,transform .08s
}
.sign-link:hover{background:var(--menu-item-hover);color:var(--nav-accent)}

.menu-btn{
  appearance:none;border:1px solid var(--nav-border);background:var(--menu-item-bg);
  color:var(--nav-fg);padding:6px 10px;border-radius:8px;cursor:pointer;
  transition:background .2s,border-color .2s,transform .08s;display:inline-flex;align-items:center;justify-content:center
}
.menu-btn:hover{background:var(--menu-item-hover);border-color:var(--nav-accent)}
.menu-btn:active{transform:translateY(1px)}

.menu-icon{width:22px;height:14px;position:relative}
.menu-icon span{
  position:absolute;left:0;right:0;height:2px;border-radius:2px;background:currentColor;
  transform-origin:center;transition:transform .2s,opacity .2s,top .2s
}
.menu-icon span:nth-child(1){top:0}
.menu-icon span:nth-child(2){top:6px}
.menu-icon span:nth-child(3){top:12px}

.menu-bar{
  background:var(--menu-bg);border-top:1px solid var(--nav-border);
  overflow:hidden;max-height:0;transition:max-height .25s ease
}
.menu-bar.open{/* JS sets inline max-height */}
.menu-bar-content{
  max-width:2000px;margin:0 auto;padding:6px 10px;
  display:grid;grid-template-columns:repeat(2,max-content);gap:6px
}
.menu-item{
  display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:8px;
  border:1px solid var(--nav-border);background:var(--menu-item-bg);color:var(--nav-fg);
  text-decoration:none;font-size:13px;transition:background .2s,border-color .2s,color .2s,transform .08s;white-space:nowrap
}
.menu-item:hover{background:var(--menu-item-hover);border-color:var(--nav-accent);color:var(--nav-accent)}
.menu-item:active{transform:translateY(1px)}
button.menu-item{cursor:pointer}

@media (min-width: 768px){
  nav .inner{padding:8px 16px}
  .nav-title a{font-size:19px;padding:5px 8px}
  .menu-bar-content{padding:6px 12px;grid-template-columns:repeat(3,max-content);gap:6px}
}
@media (min-width: 1024px){
  .menu-bar-content{display:flex;align-items:center;flex-wrap:wrap;gap:8px;padding:6px 14px 8px}
  .menu-btn{display:inline-flex}
}

a.menu-item:focus-visible,
.sign-link:focus-visible,
.menu-btn:focus-visible,
.nav-title a:focus-visible,
button.menu-item:focus-visible{
  outline:2px solid var(--nav-accent);outline-offset:2px
}

.menu-item.admin-only::after{content:"• admin";font-size:11px;margin-left:6px;opacity:.55}

/* KPI 분모 숫자 가독성 */
#kpiBase{ font-variant-numeric: tabular-nums; }

.modal-calc{
  margin-top:10px; background:#0c121a; border:1px solid var(--border);
  border-radius:10px; padding:10px;
}
.modal-calc .formula div{ margin:4px 0; }
.modal-calc .dim{ color:#9fb2c7; font-size:12px; margin-left:6px; }
.modal-calc .hint{ color:#9fb2c7; font-size:12px; margin-top:6px }
.modal-calc .note{ padding:10px; border-radius:8px; background:#0e1420; border:1px solid #132036; }
.modal-calc .note.excluded{ background:#1c1212; border-color:#402525; }
.modal-calc details{ margin-top:8px }
.modal-calc summary{ cursor:pointer; color:#cfe0f5 }
.modal-calc ol{ margin:8px 0 0 18px }
.modal-calc code{ background:#0b0f14; padding:1px 6px; border-radius:6px; border:1px solid var(--border) }

/* ===== Modal - 계산식 상세 ===== */
.calc-box { 
  margin-top: 12px; 
  background: rgba(2,6,23,0.5);
  border: 1px solid rgba(96,165,250,0.25);
  border-radius: 12px;
  padding: 12px 14px;
  color: #dbe7fb;
}

.calc-box .formula > div { 
  line-height: 1.6; 
  margin: 2px 0; 
}

.calc-box .dim { 
  opacity: .7; 
  font-size: .9em; 
}

.calc-box .note {
  border-radius: 10px;
  padding: 10px 12px;
  background: rgba(234,179,8,0.08);
  border: 1px dashed rgba(234,179,8,0.35);
  color: #fde68a;
  margin: 6px 0 4px;
}

.calc-box .note.excluded{
  background: rgba(244,63,94,0.08);
  border-color: rgba(244,63,94,0.35);
  color: #fecaca;
}

.calc-box details.workers {
  margin-top: 10px;
  background: rgba(15,23,42,0.45);
  border: 1px solid rgba(148,163,184,0.18);
  border-radius: 10px;
  padding: 8px 10px;
}

.calc-box details.workers summary {
  cursor: pointer;
  font-weight: 700;
  color: #cfe0f5;
  outline: none;
}

.calc-box details.workers ol {
  margin: 8px 0 0 16px;
  padding: 0 0 6px 0;
}

.calc-box code { 
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; 
  background: rgba(2,6,23,0.55);
  border: 1px solid rgba(148,163,184,0.18);
  padding: 1px 6px;
  border-radius: 6px;
}
