<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>유상(EMS) 상세 조회/분석</title>
  <!-- 기존 톤 재사용 -->
  <link rel="stylesheet" href="/css/worklog.css">
  <!-- 이 페이지 전용 -->
  <link rel="stylesheet" href="/css/paid-report.css">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>

    <nav>
        <div class="inner">
            <div class="nav-container">
                <h1 class="nav-title"><a href="./index.html">S-WORKS</a></h1>
                <div class="sign-container unsigned">
                    <a href="./signin.html" class="sign-link">Login</a>
                </div>
                <div class="sign-container signed hidden">
                    <button class="menu-btn">
                        <div class="menu-icon">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
        <div class="menu-bar">
            <div class="menu-bar-content">
                <a href="./user_info.html" class="menu-item">SECM</a>
                <a href="./worklog.html" class="menu-item">Create Worklog</a>
                <a href="./approval.html" class="menu-item">Worklog Approval</a>
                <a href="./loadworklog.html" class="menu-item">Load Worklog</a>
                <a href="./equipment_signal.html" class="menu-item">Equipment</a>
                <a href="./Setupeq.html" class="menu-item">Setup EQ</a>
                <a href="./PCI.html" class="menu-item">PCI</a>
                <a href="./CHECKLIST.html" class="menu-item">Checklist</a>
                <a href="./business.html" class="menu-item">Business trip</a>
                <a href="./report.html" class="menu-item">국내 출장 보고서</a>
                <a href="./workload.html" class="menu-item admin-only">Operating Rate</a>
                <a href="./analysis.html" class="menu-item admin-only">Predicted Workers</a>
                <a href="./update.html" class="menu-item">Update</a>
                <button id="sign-out" class="menu-item">Logout</button>
            </div>
        </div>
    </nav>

<main>
  <section class="inner report-wrap">
    <header class="report-head">
      <h1>유상(EMS) 상세 조회/분석</h1>
      <div class="head-actions">
        <button id="btn-search" class="btn-primary">조회</button>
        <button id="btn-reset" class="btn-secondary">초기화</button>
        <button id="btn-export" class="btn-primary">엑셀(CSV)로 내보내기</button>
      </div>
    </header>

    <!-- 필터 -->
    <div class="filter-grid">
      <div class="form-row">
        <label>작업 날짜(From)</label>
        <input type="date" id="f-date-from">
      </div>
      <div class="form-row">
        <label>작업 날짜(To)</label>
        <input type="date" id="f-date-to">
      </div>
      <div class="form-row">
        <label>그룹</label>
        <select id="f-group" class="option-select">
          <option value="">ALL</option>
        </select>
      </div>
      <div class="form-row">
        <label>사이트</label>
        <select id="f-site" class="option-select">
          <option value="">ALL</option>
        </select>
      </div>
      <div class="form-row">
        <label>작업자(이름 포함검색)</label>
        <input type="text" id="f-worker" placeholder="예: 홍길동">
      </div>
      <div class="form-row">
        <label>라인</label>
        <input type="text" id="f-line" placeholder="라인명">
      </div>
      <div class="form-row">
        <label>장비 타입</label>
        <input type="text" id="f-eq-type" placeholder="equipment_type">
      </div>
      <div class="form-row">
        <label>장비 명</label>
        <input type="text" id="f-eq-name" placeholder="equipment_name">
      </div>
      <div class="form-row">
        <label>EMS</label>
        <select id="f-ems">
          <option value="">ALL</option>
          <option value="1">유상</option>
          <option value="0">무상</option>
        </select>
      </div>
    </div>

    <!-- 카드 요약 -->
    <div class="cards">
      <div class="card">
        <p class="card-k">총 건수</p>
        <p class="card-v" id="sum-count">0</p>
      </div>
      <div class="card">
        <p class="card-k">총 인원(고유)</p>
        <p class="card-v" id="sum-people">0</p>
      </div>
      <div class="card">
        <p class="card-k">작업 시간 합계(Inform)</p>
        <p class="card-v" id="sum-inform">0h</p>
      </div>
      <div class="card">
        <p class="card-k">라인 체류시간 합계</p>
        <p class="card-v" id="sum-line">0h</p>
      </div>
    </div>

    <!-- 테이블 -->
    <div class="table-wrap">
      <table id="paid-table">
        <thead>
          <tr>
            <th>날짜</th>
            <th>그룹</th>
            <th>사이트</th>
            <th>라인</th>
            <th>장비타입</th>
            <th>장비명</th>
            <th>작업자</th>
            <th>라인입실</th>
            <th>라인퇴실</th>
            <th>작업시작</th>
            <th>작업완료</th>
            <th>Inform(분)</th>
            <th>Line(분)</th>
            <th>작업명</th>
            <th>work_log_id</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <!-- 페이지네이션 -->
      <div class="pager">
        <button id="pg-prev" class="btn-secondary">이전</button>
        <span id="pg-info">0 / 0</span>
        <button id="pg-next" class="btn-secondary">다음</button>

        <div class="pager-right">
          <label for="pg-size">표시</label>
          <select id="pg-size">
            <option>20</option>
            <option selected>50</option>
            <option>100</option>
            <option>200</option>
          </select>
          <span>행</span>
        </div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="inner">
    <p>© S-WORKS</p>
  </div>
</footer>

<script src="/js/paid-report.js"></script>
<script>
        document.addEventListener("DOMContentLoaded", function() {
            const token = localStorage.getItem("x-access-token");
            const userRole = localStorage.getItem("user-role");

            if (!token) {
                document.querySelector(".unsigned").classList.remove("hidden");
                document.querySelector(".signed").classList.add("hidden");
            } else {
                document.querySelector(".unsigned").classList.add("hidden");
                document.querySelector(".signed").classList.remove("hidden");
            }

            if (!token || userRole !== 'admin') {
                document.querySelectorAll('.admin-only').forEach(element => {
                    element.style.display = 'none';
                });
            }

            const signOutButton = document.querySelector("#sign-out");

            if (signOutButton) {
                signOutButton.addEventListener("click", function() {
                    localStorage.removeItem("x-access-token");
                    localStorage.removeItem("user-role");
                    alert("로그아웃 되었습니다.");
                    window.location.replace("./signin.html");
                });
            }
        });
</script>
</body>
</html>
