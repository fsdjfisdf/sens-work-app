<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operating Rate</title>
    <link rel="stylesheet" href="./css/operatingrate.css">
</head>
<body>

    <nav>
        <div class="inner">
            <div class="nav-container">
                <h1 class="nav-title"><a href="./index.html">S-WORKS</a></h1>
                <div class="sign-container unsigned">
                    <a href="./signin.html" class="sign-link">Login</a>
                </div>
                <div class="sign-container signed hidden">
                    <button class="menu-btn">
                        <div class="menu-icon">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
        <div class="menu-bar">
            <div class="menu-bar-content">
                <a href="./user_info.html" class="menu-item">SECM</a>
                <a href="./worklog.html" class="menu-item">Create Worklog</a>
                <a href="./readworklog.html" class="menu-item">Load Worklog</a>
                <a href="./equipment.html" class="menu-item">Equipment</a>
                <a href="./PCI.html" class="menu-item">PCI</a>
                <a href="./CHECKLIST.html" class="menu-item">Checklist</a>
                <a href="./report.html" class="menu-item">국내 출장 보고서</a>
                <a href="./group-site-stats.html" class="menu-item admin-only">Operating Rate</a>
                <a href="./regression_analysis.html" class="menu-item admin-only">Predicted Workers</a>
                <button id="sign-out" class="menu-item">Logout</button>
            </div>
        </div>
    </nav>

<div class="filter-section-fixed">
    <div class="filter-section">
        <label>START DATE: <input type="date" id="start-date"></label>
        <label>END DATE: <input type="date" id="end-date"></label>
        <label>GROUP:
            <select id="group-select">
                <option value="">ALL GROUP</option>
                <option value="PEE1">PEE1</option>
                <option value="PEE2">PEE2</option>
                <option value="PSKH">PSKH</option>
            </select>
        </label>

        <label>SITE:
            <select id="site-select">
                <option value="">ALL SITE</option>
                <option value="PT">PT</option>
                <option value="HS">HS</option>
                <option value="IC">IC</option>
                <option value="CJ">CJ</option>
                <option value="PSKH">PSKH</option>
            </select>
        </label>

        <label>WORKDAY & HOLIDAY
            <select id="day-type-select">
                <option value="all">ALL</option>
                <option value="workday">Workday</option>
                <option value="holiday">Holiday</option>
            </select>
        </label>

        <button id="filter-btn">SEARCH</button>
        <button id="reset-btn">RESET</button>
    </div>
</div>

<main class="main-content">
    <section id="operating-rate-section" class="section">
        <div class="inner">
            <h2 class="section-title">Operating Rate</h2>
                <div class="chart-container">
                    <div class="donut-chart-wrapper">
                        <div id="average-operating-rate" class="average-operating-rate">
                            <p>전체 평균 가동율: <span id="average-operating-rate-value">0%</span></p>
                            <canvas id="donutChart"></canvas>
                        </div>
                    </div>
                <div class="info-section">
                    <p><strong>Total Worktime:</strong> <span id="totalWorktime">0시간 0분</span></p>
                    <p><strong>Work Days:</strong> <span id="workDays">0</span> days</p>
                    <p><strong>Total Engineers:</strong> <span id="totalEngineers">0</span></p>
                    <p><strong>Required Engineers:</strong> <span id="requiredEngineers">0</span></p>
                    <p><strong>Average Worktime per Eng'r:</strong> <span id="avgWorktimePerEngineer">0시간</span></p>
                </div>
            </div>
        </div>
    </section> 


    <section id="calendar-section" class="section">
        <div class="inner">
            <h2 class="section-title">Calendar for Operating Rate</h2>
                <button id="prev-month">Last Month</button>
                <button id="next-month">Next Month</button>
                <div id="current-month" class="current-month"></div>
                <div class="calendar">
                    <div id="days-row" class="days-row"></div>
                    <div id="calendar-container" class="calendar-container"></div>
                </div>
        </div>
    </section>

    <div class="chart-pakage3">
        <h3>Weekly Operating Rate</h3>
        <canvas id="weeklyOperatingRateChart"></canvas>
    </div>



    <section id="charts">
        <div class="inner">
        <div class="chart-pakage1">
            <div class="chart-pakage2">
                <h3>Monthly Worktime</h3>
                <canvas id="monthlyWorktimeChart"></canvas>
            </div>

            
            <div class="chart-pakage2">
                <h3>LINE</h3>
                <canvas id="lineWorkStatsChart"></canvas>
            </div>
            

            <div class="chart-pakage2">
                <h3>Work Type</h3>
                <canvas id="workTypeStatsChart"></canvas>
            </div>

            <div class="chart-pakage2">
                <h3>EQ Type</h3>
                <canvas id="equipmentTypeStatsChart"></canvas>
            </div>

            <div class="chart-pakage2">
                <h3>AM vs PM</h3>
                <canvas id="amPmStatsChart"></canvas>
            </div>

            <div class="chart-pakage2">
                <h3>Regular vs Overtime</h3>
                <canvas id="overtimeChart"></canvas>
            </div>

            <div class="chart-pakage2">
                <h3>Time Range</h3>
                <canvas id="timeRangeChart"></canvas>
            </div>

            <div class="chart-pakage2">
                <h3>Warranty</h3>
                <canvas id="warrantyChart"></canvas>
            </div>

            <div class="chart-pakage2">
                <h3>Group & Site Operating Rates</h3>
                <canvas id="groupSiteOperatingRateChart"></canvas>
            </div>


    <!-- 모달 창 -->
    <div id="modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span id="close-modal" class="close-button">&times;</span>
            <h2>Detail</h2>
            
            <!-- 탭 버튼 -->
            <div class="tab-menu">
                <button id="info-tab" class="tab-button">EXPLAIN</button>
                <button id="worker-tab" class="tab-button">WORK TYPE</button>
            </div>
            
            <!-- 탭 콘텐츠 -->
            <div id="modal-info" class="tab-content">
                <!-- INFO 탭의 콘텐츠는 JavaScript에서 동적으로 추가됩니다 -->
            </div>
            <div id="modal-worker" class="tab-content" style="display: none;">
                <!-- WORKER 탭의 콘텐츠는 JavaScript에서 동적으로 추가됩니다 -->
            </div>
        </div>
    </div>
</main>
    <footer>
        <div class="inner">
            <p>제공되는 모든 정보는 SEnS의 사외비로 간주되며, 무단으로 정보의 유출, 복사, 배포를 금지하며, 위반 시 법적 조치가 취해질 수 있습니다.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<!-- 먼저 Chart.js 로드 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- 이후 Chart.js 플러그인 로드 -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <script src="./js/operatingrate.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const token = localStorage.getItem("x-access-token");
            const userRole = localStorage.getItem("user-role");
    
            if (!token) {
                document.querySelector(".unsigned").classList.remove("hidden");
                document.querySelector(".signed").classList.add("hidden");
            } else {
                document.querySelector(".unsigned").classList.add("hidden");
                document.querySelector(".signed").classList.remove("hidden");
            }
    
            if (!token || userRole !== 'admin') {
                document.querySelectorAll('.admin-only').forEach(element => {
                    element.style.display = 'none';
                });
            }
    
            const signOutButton = document.querySelector("#sign-out");
    
            if (signOutButton) {
                signOutButton.addEventListener("click", function() {
                    localStorage.removeItem("x-access-token");
                    localStorage.removeItem("user-role");
                    alert("로그아웃 되었습니다.");
                    window.location.replace("./signin.html");
                });
            }
            const menuBtn = document.querySelector('.menu-btn');
            const menuBar = document.querySelector('.menu-bar');
    
            menuBtn.addEventListener('click', function() {
                menuBar.classList.toggle('open');
            });
    
            document.addEventListener('click', function(event) {
                if (!menuBtn.contains(event.target) && !menuBar.contains(event.target)) {
                    menuBar.classList.remove('open');
                }
            });
        });
        document.addEventListener('DOMContentLoaded', async () => {
                const token = localStorage.getItem('x-access-token');
                if (!token) {
                    alert('로그인이 필요합니다.');
                    window.location.replace('./signin.html');
                    return;
                }
        }
    )
        
    </script>
</body>
</html>
